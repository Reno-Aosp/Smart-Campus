SELECT * FROM USERS;
SELECT * FROM MAHASISWA;
SELECT * FROM MATA_KULIAH;
SELECT * FROM ABSENSI;
SELECT * FROM DOSEN;
SELECT * FROM PROGRAM_STUDI;
SELECT * FROM UAS2.DOSEN;
SELECT * FROM KELAS_MAHASISWA;
SELECT * FROM KELAS;
SELECT * FROM JADWAL_KULIAH;
SELECT * FROM NILAI;
SELECT COUNT(*) AS CNT FROM users WHERE username = :username OR nim = :nim



DESC MATA_KULIAH;
DESC DOSEN;

SELECT DOSEN_ID, NAMA_LENGKAP FROM DOSEN;
SELECT * FROM DOSEN WHERE DOSEN_ID = '1';

SELECT constraint_name, table_name, r_constraint_name
FROM user_constraints
WHERE table_name = 'MATA_KULIAH' AND constraint_type = 'R';

SELECT
    a.constraint_name,
    a.table_name AS child_table,
    a.column_name AS child_column,
    c_pk.table_name AS parent_table,
    b.column_name AS parent_column
FROM all_cons_columns a
JOIN all_constraints c ON a.owner = c.owner AND a.constraint_name = c.constraint_name
JOIN all_constraints c_pk ON c.r_owner = c_pk.owner AND c.r_constraint_name = c_pk.constraint_name
JOIN all_cons_columns b ON c_pk.constraint_name = b.constraint_name AND b.position = a.position
WHERE c.constraint_type = 'R'
  AND a.table_name = 'MATA_KULIAH'
  AND a.constraint_name = 'FK_MATKUL_DOSEN';
  
SELECT DOSEN_ID, NAMA_LENGKAP FROM DOSEN WHERE DOSEN_ID IN (1,2);

INSERT INTO MATA_KULIAH (KODE_MATKUL, NAMA_MATKUL, SKS, SEMESTER, PRODI_ID, DOSEN_ID)
VALUES ('TEST123', 'Tes FK', 3, 1, 1, 1);

DELETE FROM MATA_KULIAH WHERE MATKUL_ID = '17';
DELETE FROM USERS WHERE user_id = '4';
DELETE FROM DOSEN WHERE DOSEN_ID = '1';

ALTER SESSION SET CURRENT_SCHEMA = UAS2;

SELECT * FROM UAS2.DOSEN;
SELECT OWNER, TABLE_NAME, R_OWNER, R_TABLE_NAME FROM ALL_CONSTRAINTS WHERE CONSTRAINT_NAME = 'FK_MATKUL_DOSEN';

SELECT 
    a.owner AS fk_owner,
    a.table_name AS fk_table,
    a.constraint_name,
    c.owner AS pk_owner,
    c.table_name AS pk_table
FROM all_constraints a
JOIN all_constraints c ON a.r_constraint_name = c.constraint_name
WHERE a.constraint_name = 'FK_MATKUL_DOSEN';

-- Untuk tabel USERS
CREATE SEQUENCE USERS_SEQ
  START WITH 1
  INCREMENT BY 1
  NOCACHE;

-- Untuk tabel MAHASISWA
CREATE SEQUENCE MAHASISWA_SEQ
  START WITH 1
  INCREMENT BY 1
  NOCACHE;
  
CREATE SYNONYM seq_users FOR USERS_SEQ;
CREATE SYNONYM seq_mahasiswa FOR MAHASISWA_SEQ;

CREATE SEQUENCE users_seq START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE mahasiswa_seq START WITH 1 INCREMENT BY 1;

SELECT constraint_name, table_name, search_condition
FROM all_constraints
WHERE constraint_name = 'SYS_C0013899';

-- Sequence untuk tabel USERS (kalau belum ada)
CREATE SEQUENCE SEQ_USERS
START WITH 1
INCREMENT BY 1
NOCACHE
NOCYCLE;

-- Sequence untuk tabel DOSEN
CREATE SEQUENCE SEQ_DOSEN
START WITH 1
INCREMENT BY 1
NOCACHE
NOCYCLE;

-- Cek jumlah mahasiswa di tabel mahasiswa
SELECT * FROM mahasiswa;

-- Cek jumlah users role mahasiswa
SELECT * FROM users WHERE role = 'mahasiswa';

-- Cek perbandingan nim
SELECT u.username, u.nim AS nim_user, m.nim AS nim_mahasiswa, m.nama_lengkap
FROM users u
LEFT JOIN mahasiswa m ON u.nim = m.nim
WHERE u.role = 'mahasiswa';

UPDATE users
SET role = 'mahasiswa'
WHERE username = 'Zuhri';

-- hapus data dependent mahasiswa
DELETE FROM nilai
WHERE mahasiswa_id IN (
    SELECT mahasiswa_id 
    FROM mahasiswa m
    JOIN users u ON m.user_id = u.user_id
    WHERE u.role = 'mahasiswa'
);

DELETE FROM kelas_mahasiswa
WHERE mahasiswa_id IN (
    SELECT mahasiswa_id 
    FROM mahasiswa m
    JOIN users u ON m.user_id = u.user_id
    WHERE u.role = 'mahasiswa'
);

DELETE FROM absensi
WHERE mahasiswa_id IN (
    SELECT mahasiswa_id 
    FROM mahasiswa m
    JOIN users u ON m.user_id = u.user_id
    WHERE u.role = 'mahasiswa'
);

-- hapus mahasiswa
DELETE FROM mahasiswa
WHERE user_id IN (
    SELECT user_id
    FROM users
    WHERE role = 'mahasiswa'
);

-- hapus user
DELETE FROM users
WHERE role = 'mahasiswa';

-- Kelas Sistem Informasi Semester 3
INSERT INTO KELAS (
    KELAS_ID, KODE_KELAS, NAMA_KELAS, PRODI_ID, SEMESTER, TAHUN_AJARAN, CREATED_AT, UPDATED_AT
) VALUES (
    kelas_seq.NEXTVAL,
    'SI-3A',
    'SI-3A',
    2,
    3,
    '2025/2026',
    SYSTIMESTAMP,
    SYSTIMESTAMP
);

INSERT INTO KELAS (
    KELAS_ID, KODE_KELAS, NAMA_KELAS, PRODI_ID, SEMESTER, TAHUN_AJARAN, CREATED_AT, UPDATED_AT
) VALUES (
    kelas_seq.NEXTVAL,
    'SI-3B',
    'SI-3B',
    2,
    3,
    '2025/2026',
    SYSTIMESTAMP,
    SYSTIMESTAMP
);

-- Kelas Teknik Informatika Semester 3
INSERT INTO KELAS (
    KELAS_ID, KODE_KELAS, NAMA_KELAS, PRODI_ID, SEMESTER, TAHUN_AJARAN, CREATED_AT, UPDATED_AT
) VALUES (
    kelas_seq.NEXTVAL,
    'TI-3A',
    'TI-3A',
    1,
    3,
    '2025/2026',
    SYSTIMESTAMP,
    SYSTIMESTAMP
);

INSERT INTO KELAS (
    KELAS_ID, KODE_KELAS, NAMA_KELAS, PRODI_ID, SEMESTER, TAHUN_AJARAN, CREATED_AT, UPDATED_AT
) VALUES (
    kelas_seq.NEXTVAL,
    'TI-3B',
    'TI-3B',
    1,
    3,
    '2025/2026',
    SYSTIMESTAMP,
    SYSTIMESTAMP
);

COMMIT;

CREATE SEQUENCE kelas_seq
START WITH 3  -- karena KELAS_ID terakhir yang ada sekarang 2
INCREMENT BY 1
NOCACHE
NOCYCLE;

UPDATE KELAS
SET SEMESTER = 3
WHERE KODE_KELAS = 'TK-3A' OR KODE_KELAS = 'TK-3B';



